

<!DOCTYPE html>
<html>
  <head>
    <style>
      </style>
        <link rel="icon" href="data:;base64,iVBORw0KGgo=">
        <meta charset="UTF-8">
        <title>Dispense</title>
        <link rel="stylesheet" href="/static/style.css">
  </head>
  <body>
    {% include "headers/isLoggedinHeader.html" %}
    merchant.html
    <div id="storesTable"></div>
    <script>

        function makeStoreAndVendingMachineTable(stores, vendingMachines) {
            const columns = ["machineId", "merchantId_fk","storeid_fk"]
            function findStoreById(storeId) {
                for (let i = 0; i < vendingMachines.length; i++) {
                    if (vendingMachines[i].storeid_fk === storeId) {
                        return true;
                    }
                }
                return false;
            }
            function createVendingMachineTBody(storeId) { 
                let x = ""
                if ( findStoreById(storeId) === true ) { 
                    x = "<tbody class='childTable'><tr><th class='skip'></th>"
                    columns.forEach((column)=> { 
                        x += `<th>${column}</th>`
                    })
                    x += "</tr>"
                    // 
                    vendingMachines.forEach((vm)=> { 
                        if ( vm.storeid_fk == storeId ) {
                        x += "<tr><td class='skip'></td>" 
                        columns.forEach((column)=> {
                            const v = vm[column] 
                            x += `<td>${v}</td>`
                        })                            
                        x += "</tr>"
                    }
                    })
                    x += "</tbody>"
                }
                return x
            }





            let table = "<table border='10' class='storeTable'><tr>"
            let keys = Object.keys(stores[0])
            keys.forEach((column)=>{
                table += "<th>" + column + "</th>"
            })
            table += "</tr>"
            stores.forEach((store)=> { 
                table += "<tr>"
                keys.forEach((k)=> {
                    const v = store[k]
                    table += `<td>${v}</td>`
                })
                table += "</tr>"
                table += createVendingMachineTBody(store["storeId"])
            })
            table += "</table>"
            document.getElementById("storesTable").innerHTML = table
        }


        const vendingMachines = JSON.parse('{{ vendingMachines | tojson }}')  
        const stores = JSON.parse('{{ stores | tojson }}')

        console.log("vendingMachine")
       //  console.log(vendingMachines )
        //console.log("sotres")
        makeStoreAndVendingMachineTable(stores, vendingMachines)


//        console.log( JSON.stringify(stores, null, 2 ) )
    </script>
    <script src="/static/bag_of_functions.js"></script>
  </body>
</html>